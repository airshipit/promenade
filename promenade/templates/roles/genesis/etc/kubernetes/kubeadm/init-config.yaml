{% if 'kubeadm=enabled' in config.get_first('Genesis:labels.dynamic', 'KubernetesNode:labels.dynamic') -%}
apiVersion: kubeadm.k8s.io/v1beta4
bootstrapTokens: []
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: "{{ config['Genesis:ip'] }}"
  bindPort: 6443
nodeRegistration:
  ignorePreflightErrors:
  - IsPrivilegedUser
  - ExternalEtcdVersion
  - Port-10250
  imagePullPolicy: IfNotPresent
  imagePullSerial: false
  name: "{{ config['Genesis:hostname'] }}"
  criSocket: "unix:///run/containerd/containerd.sock"
  taints: []
skipPhases:
- certs
- kubeconfig
- etcd
- kubelet-start
- upload-config
- upload-certs
- mark-control-plane
- kubelet-finalize
- addon
- show-join-command
timeouts:
  controlPlaneComponentHealthCheck: 4m0s
  discovery: 5m0s
  etcdAPICall: 2m0s
  kubeletHealthCheck: 4m0s
  kubernetesAPICall: 1m0s
  tlsBootstrap: 5m0s
  upgradeManifests: 5m0s
---
{{ config.get(schema='armada/Chart/v1', name='kubernetes-kubeadm', jsonpath='values.kubeadm.cluster_config') | toyaml | trim }}
{%- endif %}
